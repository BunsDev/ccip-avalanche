---
# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

image: gitpod/workspace-full

# Commands that will run on workspace start

# tasks
# - name: Creates New Terminal
# before: Tasks that run before init and command
# init: Used for heavy-lifting tasks, such as downloading dependencies and installing source code.
# command: Starting up databases or dev services (for example)
# notes on task ordering:
# gp sync-done $NEW_TASK_NAME
# gp sync-await $DONE_TASK_NAME

# rm -rf .gitmodules && rm -rf .git/modules/* && rm -rf lib && touch .gitmodules && git add . && git commit -m "modules"

# note: make .env this conditional
    # cp .env.example .env && source .env
tasks:
  - name: Environment
    init: |
      if [ -f .env ]; then
        echo "Found .env in workspace"
      else
        if [ -z "${DOTENV}" ]; then
          echo "Setting example .env"
          cp .env.example .env  
      else
        # After making changes to .env, run this line to persist it to $DOTENV
        #   gp env DOTENV="$(base64 .env | tr -d '\n')"
        #
        # Environment variables set this way are shared between all your workspaces for this repo
        # The lines below will read $DOTENV and print a .env file
        echo "Restoring .env from Gitpod"
        echo "${DOTENV}" | base64 -d > .env
        fi
      fi

  - name: Foundry
    before: |
      curl -L https://foundry.paradigm.xyz | bash && source ~/.bashrc && foundryup
    init: |
      make
      gp sync-done foundry

  - name: Setup
    openMode: tab-after
    before: yarn && source /home/gitpod/.bashrc
    init: |
      gp sync-await foundry
      yarn setup
      gp sync-done setup

  - name: t:Sender
    openMode: tab-after
    init: |
      gp sync-await setup
      source /home/gitpod/.bashrc
      yarn test:send

  - name: t:Broker
    openMode: split-left
    init: |
      gp sync-await setup
      source /home/gitpod/.bashrc
      yarn test:broker

  - name: t:Receiver
    before: source /home/gitpod/.bashrc
    openMode: split-right
    init: |
      gp sync-await setup
      source /home/gitpod/.bashrc
      yarn test:receive

vscode:
    extensions:
      - stateful.runme
      - NomicFoundation.hardhat-solidity

# Ports to expose on workspace startup
# ports:
    # - port: 3000
      # onOpen: open-preview
      # name: Website
      # description: Website Preview
      # visibility: private
      # protocol: https
